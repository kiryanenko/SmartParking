Система мониторинга парковочных мест
====================================

### АННОТАЦИЯ

Дипломный проект посвящен разработке системы мониторинга парковочных
мест. При выполнении дипломного проекта, было проведено исследование IoT
технологий в сфере транспортной инфраструктуры. В рамках исследования
был проведен анализ существующих систем. На основании этого был
спроектирован недорогой относительно конкурентов аппаратно-программный
прототип системы мониторинга парковочных мест. Основное назначение
системы заключается в определении наличия свободных парковочных мест и
отображении этих данных пользователям. Данная система позволит
пользователям (водителям) в режиме реального времени получать актуальную
информацию о состоянии парковочных мест.

### ABSTRACT

The diploma project is devoted to the development of a monitoring system
for parking places. When carrying out the diploma project, was conducted
research IoT technologies in the field of transport infrastructure. As
part of the research, existing systems were analyzed. Based on this, the
hardware-software prototype of a monitoring system for parking places
was designed inexpensive with respect to competitors. The main purpose
of the system is to determine the availability of parking spaces and
display data for users. This system allows users (drivers) to receive
up-to-date information about status of parking places in real time.


РЕФЕРАТ
-------

Разработан проект «Система мониторинга парковочных мест». Основное
назначение системы заключается в определении наличия свободных
парковочных мест и отображении этих данных пользователям. Данная система
позволит пользователям (водителям) в режиме реального времени получать
актуальную информацию о состоянии парковочных мест. Данная система
состоит из: «МК-подсистемы регистрации свободных парковочных мест»,
вычислительного хаба и сервера.

«МК-подсистема регистрации свободных парковочных мест» фиксирует наличие
свободных парковочных мест. К микроконтроллеру подключаются сенсоры,
каждый из которых следит за своим парковочным местом. Через радиомодуль
RFM95W информация о состоянии парковочных мест (свободно / занято)
передается в вычислительный хаб, для последующей обработки. Реализована
функция оплаты парковочного места, с отображением на дисплее и
подтверждением оплаты с клавиатуры.

Основное назначение вычислительного хаба, состоит в осуществлении
взаимодействия сервера, датчиков «МК-подсистема регистрации свободных
парковочных мест» и других компонентов системы.

Сервер осуществляет сбор данных с датчиков «МК-подсистема регистрации
свободных парковочных», управление всеми компонентами системы и вывод
данных пользователям об актуальном состоянии парковочных мест

Материалы по дипломному проекту представлены в виде графической части,
приложения с отлаженным программным кодом и расчетно-пояснительной
записки.

ОПРЕДЕЛЕНИЯ, ОБОЗНАЧЕНИЯ И СОКРАЩЕНИЯ
-------------------------------------

- БС - беспроводная сеть
- БД - база данных
- МК - микроконтроллер
- МКПМ - модуль контроля парковочного места
- МКПРСПМ - МК-подсистема регистрации свободных парковочных мест
- ОС - операционная система
- ПМ - парковочное место
- ПО - программное обеспечение
- СМПМ - система мониторинга парковочных мест
- СУБД - система управления базами данных
- ТС - транспортное средство
- УГО - условно графическое обозначение.
- EEPROM - энергонезависимая перезаписываемая память
- IoT - internet of things
- LoRa - Long Range, метод модуляции в беспроводных сетях
- MQTT - message queue telemetry transport


СОДЕРЖАНИЕ
----------

[ВВЕДЕНИЕ](#ВВЕДЕНИЕ)

[Анализ требований к СМПМ](#Анализ-требований-к-СМПМ)

[Разработка диаграммы вариантов использований](#Разработка-диаграммы-вариантов-использований)

[Описание и структура СМПМ](#Описание-и-структура-СМПМ)

[Описание функциональной схемы СМПМ](#Описание-функциональной-схемы-СМПМ)

[Тестирование СМПМ](#Тестирование-СМПМ)

[ЗАКЛЮЧЕНИЕ](#ЗАКЛЮЧЕНИЕ)

[Приложение А. Техническое задание](/Приложение%20А.%20ТЗ.pdf)

[Приложение Б. Формы интерфейсов](/Приложение%20Б.%20Формы%20интерфейсов.pdf)

[Приложение В. Тестирование](/Приложение%20В.%20Тестирование%20СMПМ.pdf)

[Приложение Г. Руководство пользователя](/Приложение%20Г.%20Руководство%20пользователя.pdf)

[Приложение Е. Графическая документация](/Приложение%20Е.%20Графическая%20документация.pdf)



ВВЕДЕНИЕ
--------

Дипломный проект «Система мониторинга парковочных мест» выполняется на
основании учебного плана кафедры ИУ6 с исходными данными, заданными в
техническом задании. Целью работы является проектирование системы
мониторинга парковочных мест.

Формирование специализированных зон для стоянки автотранспорта началось
почти одновременно с появлением первых автомобилей. Число машин
стремительно растет и для решения возникнувшей проблемы ограниченности
парковочных мест начали внедрять современные технологии.

Основным направлением развития являются «умные» датчики парковки. Такие
датчики встраиваются в дорожное полотно на места парковок и отслеживают
свободно ли машиноместо над ними, отдавая данные в общую систему.
Используя сеть таких датчиков, формируется карта парковок, состояния
которых рассылается пользователям на улицах с помощью специальных табло
или мобильного приложения.

Такая система позволяет решить следующие задачи:
-   сокращение очередей и времени поиска свободного места на парковке;
-   организация оптимального движения транспортных средств и пешеходов
    на парковке;
-   визуальное оповещение о количестве свободных мест в реальном времени
    с помощью информационных табло или на веб-портале;
-   оптимизация работы парковочного пространства.

В ходе данной работы была спроектирована «Система мониторинга
парковочных мест». Основное назначение системы заключается в определении
наличия свободных парковочных мест и отображении этих данных
пользователям. Данная система позволит пользователям (водителям) в
режиме реального времени получать актуальную информацию о состоянии
парковочных мест. Данная система состоит из: «МК-подсистемы регистрации
свободных парковочных мест», вычислительного хаба и сервера.


Анализ требований к СМПМ
========================

Разработка диаграммы вариантов использований
--------------------------------------------

Основное назначение СМПМ заключается в определении наличия свободных
парковочных мест и отображении этих данных пользователям. Данная система
позволяет пользователям (водителям) в режиме реального времени получать
актуальную информацию о состоянии парковочных мест.

Для уточнения требований к функционированию системы необходимо
определить варианты её использования при помощи диаграммы вариантов
использования. Система взаимодействует с двумя видами действующих лиц:
пользователь (водитель) и владелец стоянки. Соответствующие диаграммы
для этих лиц показаны на рисунках 5 и 6.

![Диаграмма вариантов использований для пользователя](/docs/Diagram_of_usage_options_for_the_user.svg)

Рисунок 5 - Диаграмма вариантов использований для пользователя

![Диаграмма вариантов использований для владельца стоянки](/docs/Diagram_of_usage_options_for_the_owner.svg)

Рисунок 6 - Диаграмма вариантов использований для владельца стоянки

Описание и структура СМПМ
-------------------------

На рисунке 7 представлена структурная схема системы мониторинга
парковочных мест. Система мониторинга парковочных мест состоит из
следующих блоков:
-   МК-подсистема регистрирования свободных парковочных мест (МКПРСПМ),
-   вычислительный хаб,
-   сервер.

Датчики МКПРСПМ служат для фиксации наличия свободных парковочных мест и
оплаты. МКПРСПМ формирует пакеты с информацией о свободных парковочных
местах и передаёт их на вычислительный хаб по беспроводной сети LoRaWAN.

Вычислительный хаб, представленный в виде микрокомпьютера Raspberry Pi,
необходим для осуществления взаимодействия сервера, МКПРСПМ и других
компонентов системы. Хаб выполняет приём пакетов, переданных с МКПРСПМ,
формирует пакеты MQTT и передает их на сервер по сети интернет. Обратно
от сервера хаб получает команды управления МКПРСПМ, которые также
передаются по сети LoRaWAN, на МК-подсистемы.

Пользователь с мобильного устройства на платформе Android с
установленным приложением сможет посмотреть карту с указанием
местоположений свободных парковочных мест. Мобильное приложение получает
данные о парковочных местах с помощью API-сервисов, предоставляемых
сервером.

![Структурная схема системы мониторинга парковочных мест](/docs/Structural_scheme.svg)

Рисунок 7 - Структурная схема системы мониторинга парковочных мест

Веб-клиент, предоставляет карту со свободными парковочными местами.
Также для владельцев стоянок, предоставляется возможность для управления
за парковочными местами: изменение тарифного плана, настройка параметров
МКПСРСПМ.

Описание функциональной схемы СМПМ
----------------------------------

На рисунке Рисунок 8 показана функциональная схема СМПМ. Система
работает следующим образом. В МКПРСПМ сигнал о состоянии парковочного
места приходит от сенсора присутствия автомобиля, после чего МК
ATMEGA328 формирует пакеты и отправляет их через радиомодуль RFM95 по
сети LoRaWAN на вычислительный хаб. Также по сети LoRaWAN МКРСППМ может
принять команды для изменения настроечных параметров.

Вычислительный хаб служит для осуществления взаимодействия сервера,
МКПРСПМ и других компонентов системы. Хаб через радиомодуль RFM95
принимает пакеты, переданные с МКПРСПМ, формирует MQTT пакеты и передает
их на сервер и на другие компоненты системы. Данные внутри MQTT пакетов
передаются в формате JSON. Обратно от сервера хаб получает команды
управления МКПРСПМ, которые также передаются по сети LoRaWAN, на
МК-подсистемы. ПО для вычислительного хаба написано с использованием
фреймворка Qt. На вычислительном хабе может быть установлено серверное
ПО, тем самым хаб сформирует локальную сеть, внутри которой сможет
работать как сервер. MQTT - это легкий протокол для передачи данных,
который идеально подходит для взаимодействия большого количества IoT
устройств. Таким образом, к вычислительному хабу возможно подключить
множество других устройств (например, табло индикации количества
свободных парковочных мест), позволяющие взаимодействовать по протоколу
MQTT.

![Функциональная схема СМПМ](/docs/Functional_diagram.svg)

Рисунок 8 - Функциональная схема СМПМ

Сервер взаимодействует с вычислительным хабом по протоколу MQTT. Для
этого на сервере установлен MQTT брокер Mosquitto. Приложение на
фреймворке Ruby on Rails принимает данные о состоянии ПМ через MQTT
брокер и сохраняет в БД PostgreSQL. Также сервер может управлять
датчиками МКПРСПМ, отправляя команды по протоколу MQTT на вычислительный
хаб. Сервер Nginx является Frontend сервером, он осуществляет раздачу
статики и проксирование запросов на веб-сервер Puma, который уже
взаимодействует с веб-приложением на Ruby on Rails. Веб-приложение для
кэширования использует сервис кэширования Memcached. Для работы Action
Cable, который осуществляет взаимодействие с веб-клиентами по WebSocket,
необходима «key - value» хранилище данных Redis. Чтобы веб-клиент в
режиме реального времени получал данные о состоянии парковочных мест,
данные о парковочных местах в формате JSON периодически отправляются по
протоколу WebSocket.


Тестирование СМПМ
=================

Для проверки требований, предъявленных в техническом задании, в
разработанной системе мониторинга парковочных мест были протестированы
все компоненты системы, а также было проведено комплексное тестирование
системы (Приложение В). Для тестирования МКПРСПМ был собран отладочный
макет, внешний вид которого изображен на рисунке 30.

![](/docs/media/image32.png)

Рисунок 30 - Внешний вид отладочного макета

Также для проверки и анализа данных работоспособности при большой
нагрузки было проведено нагрузочное тестирование. Так, например, RPS для
выдачи парковочных мест (п.п. 5.4) при заполненной БД (13582 записи)
составила 846 запросов в секунду (более подробнее см. в Приложение В).

Для обеспечения качества в ходе дальнейшей разработки для веб-приложения
были написаны 60 автоматизированных теста, покрывающие весь функционал.
Из них 14 модульных теста, 6 интеграционных теста и 40 функциональных
тестов контроллеров.

Результатом проведенного тестирования было установлено, что были
выполнены все предъявляемые требования к разработанному прототипу
системы мониторинга парковочных мест.


ЗАКЛЮЧЕНИЕ
==========

В результате выполнения выпускной квалификационной работы бакалавра был
спроектирован и реализован аппаратно-программный прототип «Системы
мониторинга парковочных мест». Такая система для водителей будет в
режиме реального времени предоставлять актуальные данные о состоянии
парковочных мест. Данная система состоит из МК-подсистемы регистрации
свободных парковочных мест, вычислительного хаба и центрального сервера.

Программное обеспечение для компонентов системы написано преимущественно
в объектном стиле, который обеспечивает интеграцию и удобство для
дальнейшей разработки командой разработчиков.

В ходе выполнения работы было проведено исследование IoTтехнологий в
транспортной инфраструктуре, а также анализ существующих систем.
Разработанная система экономически более выгодна относительно
конкурентных систем.

Все компоненты системы были отлажены и протестированы. Для
разработанного серверного ПО были написаны автоматизированные тесты для
обеспечения качества в ходе дальнейшей разработки. Также был проведен
анализ безопасности системы. Таким образом, разработанная система
соответствует всем требованиям, заявленных в техническом задании.
